{% extends "base.html" %} {% block content %} {% load static %}
<div class="container-fluid">
  <div class="row">
    <!-- Left Sidebar -->
    <div class="col-md-2 border-end pe-3" style="min-height: 80vh">
      <h5 class="my-4">Explore Topics</h5>
      <div>
        <a
          class="btn btn-outline-primary border-0 opacity-75 text-black px-3 mb-3 d-flex align-items-center justify-content-between"
          href="{% url 'home' %}"
          ><span>All Topics</span>
          <span class="badge bg-secondary ms-5">{{rooms_count}}</span>
        </a>
      </div>
      <div class="mt-2">
        {% if topics %} {% for topic in topics %}
        <a
          class="btn btn-outline-primary opacity-75 border-0 text-start text-black d-flex align-items-center justify-content-between"
          href="{% url 'home' %}?q={{ topic.name|urlencode }}"
          ><span>{{ topic.name }}</span>
          <span class="badge bg-secondary me-1"
            >{{topic.room_set.all.count}}</span
          ></a
        ><br />
        {% endfor %} {% else %}
        <p>No topics yet.</p>
        {% endif %}
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-6 mx-auto px-3">
      {% include "room_form.html" %}
      <h4 class="mt-4">Explore Available Rooms</h4>
      <p>Join a room to start chatting</p>
      <!-- filepath: d:\codes\coLearner\templates\home.html -->
      <div class="row">
        {% if rooms %} {% for room in rooms %}
        <!-- filepath: d:\codes\coLearner\templates\home.html -->
        <div class="col-md-6 mb-3">
          <div
            class="d-flex flex-column justify-content-between p-4 border rounded h-100 border-secondary border-opacity-25 bg-light"
            style="min-height: 220px"
          >
            <div class="position-relative">
              <h4>{{room.name}}</h4>
              <span class="badge text-bg-primary mb-4">{{room.topic}}</span>
              <a href="{% url 'room' room.id %}" class="stretched-link"></a>
              <p class="text-start small text-muted">
                {{ room.description|truncatewords:15 }}
              </p>
            </div>
            <div class="text-start small text-muted">
              Created by -
              <a class="text-decoration-none" href="{% url 'profile' room.host.id %}"
                >@{{ room.host.username }}</a
              >
            </div>
          </div>
        </div>
        {% if forloop.counter|divisibleby:2 %}
      </div>
      <div class="row">
        {% endif %} {% endfor %} {% else %}
        <p>
          No rooms yet. Be the first to
          <button
            class="btn btn-link p-0 mb-1"
            data-bs-toggle="modal"
            data-bs-target="#createRoomModal"
          >
            create</button
          >.
        </p>
        {% endif %}
      </div>
    </div>

    <!-- Right Sidebar (Empty for now) -->
    <!-- filepath: d:\codes\coLearner\templates\home.html -->
<!-- Right Sidebar (Styled) -->
<div class="col-md-3 px-4 border-start" style="min-height: 80vh; background: #f8fafc;">
  <div class="card shadow-sm mt-4 mb-3 border-0">
    <div class="card-header bg-white border-0">
      <h4 class="mb-0">Recent Activity</h4>
    </div>
    <div class="card-body" style="max-height: 70vh; overflow-y: auto;">
      {% if room_messages %}
        {% for message in room_messages %}
          <div class="mb-3 pb-2 border-bottom">
            <a href="{% url 'profile' message.user.id %}" class=" text-decoration-none text-dark">
              @{{ message.user.username }}
            </a>
            <span class="text-muted small">
            in <a href="{% url 'room' message.room.id %}" class="text-primary text-decoration-none">{{ message.room.name }}</a>
            </span>
            <p class="mb-1 text-secondary" style="font-size: 0.95rem;">
              {{ message.body|truncatewords:10 }}
            </p>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-muted">No recent activity.</p>
      {% endif %}
    </div>
  </div>
</div>
  </div>
</div>
{% endblock %}
